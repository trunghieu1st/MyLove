<!DOCTYPE HTML>
<html>

    <head>
        <title>LOVE HANG</title>
        <meta charset="UTF-8">
        <style>
        html,
        body {
            height: 100%;
            margin: 0;
            background: #0f0505;
            overflow: hidden;
        }

        .box {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
        }

        canvas {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        /* text t√¨nh c·∫£m */
        .center-text {
            position: absolute;
            width: 100%;
            bottom: 50px;
            color: rgb(217, 38, 38);
            font-size: 40px;
            font-style: italic;
            text-align: center;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .center-text.show {
            opacity: 10;
        }

        body {
            margin: 0;
            overflow: hidden;
            /* ·∫©n scroll khi avatar ch·∫°y lung tung */
            background: #000;
            /* n·ªÅn cho d·ªÖ nh√¨n */
        }

        .music-avatar-ny {
            position: absolute;
            /* ch·∫°y t·ª± do */
            width: 15vw;
            height: 15vw;
            max-width: 120px;
            max-height: 120px;
            min-width: 60px;
            min-height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #ff5ca4;
            animation: spin 8s linear infinite;
            box-shadow: 0 0 20px rgba(255, 92, 164, 0.6);
            cursor: pointer;
        }

        .music-avatar-ny img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .music-avatar-my {
            position: absolute;
            /* ch·∫°y t·ª± do */
            width: 15vw;
            height: 15vw;
            max-width: 120px;
            max-height: 120px;
            min-width: 60px;
            min-height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #ff5ca4;
            animation: spin 8s linear infinite;
            box-shadow: 0 0 20px rgba(255, 92, 164, 0.6);
            cursor: pointer;
        }

        .music-avatar-my img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes spin {
            0% {
                transform: rotate(0);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes shake {
            0% {
                transform: translate(0, 0) rotate(0);
            }

            20% {
                transform: translate(-4px, 2px) rotate(-3deg);
            }

            40% {
                transform: translate(4px, -2px) rotate(3deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(-2deg);
            }

            80% {
                transform: translate(3px, -1px) rotate(2deg);
            }

            100% {
                transform: translate(0, 0) rotate(0);
            }
        }

        .shake {
            animation: shake 0.3s;
        }

        /* Ng·ª´ng xoay container ƒë·ªÉ rect kh√¥ng ph√¨nh */
        .music-avatar-ny,
        .music-avatar-my {
            animation: none !important;
        }

        /* Ch·ªâ xoay ·∫£nh b√™n trong */
        .music-avatar-ny img,
        .music-avatar-my img {
            animation: spin 8s linear infinite;
        }


        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            object-fit: cover;

            filter: blur(1px) brightness(0.7);
            opacity: 0.3;

            z-index: 0;

            /* Animation zoom in/out */
            animation: zoomBG 10s ease-in-out infinite alternate;
        }

        /* Zoom nh·∫π nh√†ng */
        @keyframes zoomBG {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.1);
            }
        }

        /* Optional: overlay gradient m·ªù */
        .bg::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.6));
        }

        #container {
            position: relative;
            z-index: 1;
            /* canvas n·∫±m tr√™n */
        }
    </style>
    </head>

    <body>

        <img src="dd.png" class="bg" alt="bg">

        <!-- Canvas 3D -->
        <div id="container"></div>

        <script src="three.min.js"></script>
        <script src="main.js"></script>

        <div class="box">
            <!-- n·ªÅn m∆∞a tim -->
            <canvas id="rainCanvas"></canvas>
            <!-- tim h·∫°t bay -->
            <canvas id="pinkboard"></canvas>
            <!-- text ƒë·ªïi tu·∫ßn t·ª± -->
            <div class="center-text" id="loveText">I Love You</div>
        </div>

        <!-- Avatar ny quay tr√≤n -->
        <div class="music-avatar-ny" id="avatarBtn-ny">
            <img src="my.jpg" alt="Ny c·ªßa m√¨nh">
        </div>

        <!-- Avatar m quay tr√≤n -->
        <div class="music-avatar-my" id="avatarBtn-my">
            <img src="ny.jpg" alt="Ny c·ªßa m√¨nh">
        </div>

        <!-- Player nh·∫°c -->
        <audio id="bg-music" loop>
            <source
                src="https://res.cloudinary.com/diqlmcscq/video/upload/v1753803315/snaptt.me-128kbps-1753803291658_eaov3y.mp3"
                type="audio/mp3">
        </audio>

        <script>
        const music = document.getElementById("bg-music");
        const avatarNy = document.getElementById("avatarBtn-ny");

        let xNy = Math.random() * (window.innerWidth - avatarNy.offsetWidth);
        let yNy = Math.random() * (window.innerHeight - avatarNy.offsetHeight);
        let dxNy = 2, dyNy = 2;

        function moveAvatarNy() {
            xNy += dxNy;
            yNy += dyNy;

            if (xNy <= 0 || xNy + avatarNy.offsetWidth >= window.innerWidth) dxNy = -dxNy;
            if (yNy <= 0 || yNy + avatarNy.offsetHeight >= window.innerHeight) dyNy = -dyNy;

            avatarNy.style.left = xNy + "px";
            avatarNy.style.top = yNy + "px";

            requestAnimationFrame(moveAvatarNy);
        }
        moveAvatarNy();

        avatarNy.addEventListener("click", () => {
            if (music.paused) music.play();
            else music.pause();
        });
    </script>

        <script>
        const avatarMy = document.getElementById("avatarBtn-my");

        let xMy = Math.random() * (window.innerWidth - avatarMy.offsetWidth);
        let yMy = Math.random() * (window.innerHeight - avatarMy.offsetHeight);
        let dxMy = 3, dyMy = 2; // cho kh√°c t·ªëc ƒë·ªô ƒë·ªÉ vui h∆°n üòé

        function moveAvatarMy() {
            xMy += dxMy;
            yMy += dyMy;

            if (xMy <= 0 || xMy + avatarMy.offsetWidth >= window.innerWidth) dxMy = -dxMy;
            if (yMy <= 0 || yMy + avatarMy.offsetHeight >= window.innerHeight) dyMy = -dyMy;

            avatarMy.style.left = xMy + "px";
            avatarMy.style.top = yMy + "px";

            requestAnimationFrame(moveAvatarMy);
        }
        moveAvatarMy();

        avatarMy.addEventListener("click", () => {
            if (music.paused) music.play();
            else music.pause();
        });
    </script>

        <style>
        .heart {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            animation: flyUp 1s ease-out forwards;
        }

        @keyframes flyUp {
            0% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }

            100% {
                transform: scale(0.5) translateY(-100px);
                opacity: 0;
            }
        }
    </style>

        <script>
        // L·∫•y h√¨nh tr√≤n (t√¢m & b√°n k√≠nh) t·ª´ state + k√≠ch th∆∞·ªõc th·∫≠t
        function getCircle(el, x, y) {
            const r = el.offsetWidth / 2; // avatar l√† vu√¥ng -> r = width/2
            return { x: x + r, y: y + r, r };
        }

        // Ph·∫£n x·∫° v·∫≠n t·ªëc v qua ph√°p tuy·∫øn n (ƒë√£ chu·∫©n ho√°)
        function reflect(vx, vy, nx, ny) {
            const dot = vx * nx + vy * ny;
            return [vx - 2 * dot * nx, vy - 2 * dot * ny];
        }

        // N·ªï tim quanh 1 ƒëi·ªÉm
        function spawnHearts(x, y) {
            for (let i = 0; i < 12; i++) {
                const heart = document.createElement("div");
                heart.className = "heart";
                heart.textContent = "üíñ";
                heart.style.left = x + "px";
                heart.style.top = y + "px";

                const angle = Math.random() * Math.PI * 2;
                const distance = 80 + Math.random() * 50;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;

                heart.animate(
                    [
                        { transform: `translate(0,0) scale(1)`, opacity: 1 },
                        { transform: `translate(${dx}px, ${dy}px) scale(0.5)`, opacity: 0 }
                    ],
                    { duration: 1200, easing: "ease-out", fill: "forwards" }
                );

                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 1300);
            }
        }

        let collided = false; // ch·ªët ƒë·ªÉ kh√¥ng spam collision m·ªói frame

        function checkCollisionLoop() {
            const nyEl = document.getElementById("avatarBtn-ny");
            const myEl = document.getElementById("avatarBtn-my");

            // D√ôNG state xNy,yNy,xMy,yMy (ƒë√£ c√≥ ·ªü script move) -> KH√îNG d√πng getBoundingClientRect
            const c1 = getCircle(nyEl, xNy, yNy);
            const c2 = getCircle(myEl, xMy, yMy);

            const dx = c2.x - c1.x;
            const dy = c2.y - c1.y;
            const dist = Math.hypot(dx, dy);
            const sumR = c1.r + c2.r;

            if (dist <= sumR) {
                if (!collided) {
                    // N·ªï tim ƒë√∫ng ƒëi·ªÉm ch·∫°m (gi·ªØa hai t√¢m)
                    spawnHearts((c1.x + c2.x) / 2, (c1.y + c2.y) / 2);

                    // Rung nh·∫π
                    nyEl.classList.add("shake");
                    myEl.classList.add("shake");
                    setTimeout(() => {
                        nyEl.classList.remove("shake");
                        myEl.classList.remove("shake");
                    }, 300);

                    // ƒê·∫©y t√°ch ra ƒë·ªÉ kh√¥ng d√≠nh
                    const nx = dist === 0 ? 1 : dx / dist; // ph√≤ng TH tr√πng t√¢m hi·∫øm g·∫∑p
                    const ny = dist === 0 ? 0 : dy / dist;
                    const overlap = sumR - dist + 0.1; // +epsilon ƒë·ªÉ ch·∫Øc ch·∫Øn r·ªùi nhau
                    xNy -= nx * overlap / 2;
                    yNy -= ny * overlap / 2;
                    xMy += nx * overlap / 2;
                    yMy += ny * overlap / 2;

                    // B·∫≠t n·∫©y: ph·∫£n x·∫° v·∫≠n t·ªëc theo ph√°p tuy·∫øn va ch·∫°m
                    [dxNy, dyNy] = reflect(dxNy, dyNy, nx, ny);
                    [dxMy, dyMy] = reflect(dxMy, dyMy, -nx, -ny);

                    collided = true; // kho√° cho ƒë·∫øn khi r·ªùi nhau
                }
            } else {
                collided = false;
            }

            requestAnimationFrame(checkCollisionLoop);
        }

        checkCollisionLoop();


    </script>

        <script>
        // ================= M∆∞a tr√°i tim background =================
        const rainCanvas = document.getElementById("rainCanvas");
        const rainCtx = rainCanvas.getContext("2d");
        let hearts = [];

        function resizeRain() {
            rainCanvas.width = window.innerWidth;
            rainCanvas.height = window.innerHeight;
        }
        window.addEventListener("resize", resizeRain);
        resizeRain();

        class Heart {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * rainCanvas.width;
                this.y = Math.random() * -rainCanvas.height;
                this.size = 1 + Math.random() * 8;
                this.speed = 1 + Math.random() * 3;
                this.alpha = 0.1 + Math.random() * 0.5;
            }
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.size / 20, this.size / 20);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.bezierCurveTo(-10, -10, -25, 10, 0, 25);
                ctx.bezierCurveTo(25, 10, 10, -10, 0, 0);
                ctx.closePath();
                ctx.fillStyle = "rgba(255, 92, 164," + this.alpha + ")";
                ctx.fill();
                ctx.restore();
            }
            update() {
                this.y += this.speed;
                if (this.y > rainCanvas.height + this.size) {
                    this.reset();
                }
            }
        }

        for (let i = 0; i < 80; i++) {
            hearts.push(new Heart());
        }

        function rainLoop() {
            rainCtx.clearRect(0, 0, rainCanvas.width, rainCanvas.height);
            for (let h of hearts) {
                h.update();
                h.draw(rainCtx);
            }
            requestAnimationFrame(rainLoop);
        }
        rainLoop();

        // ================= Tim h·∫°t bay ·ªü gi·ªØa =================
        var settings = { particles: { length: 222, duration: 2, velocity: 100, effect: -1.3, size: 13 } };
        var Point = function (x, y) { this.x = x || 0; this.y = y || 0 };
        Point.prototype.clone = function () { return new Point(this.x, this.y) };
        Point.prototype.length = function (length) {
            if (length === undefined) return Math.sqrt(this.x * this.x + this.y * this.y);
            this.normalize(); this.x *= length; this.y *= length; return this;
        };
        Point.prototype.normalize = function () { var length = this.length(); this.x /= length; this.y /= length; return this };

        var Particle = function () { this.position = new Point(); this.velocity = new Point(); this.acceleration = new Point(); this.age = 0 };
        Particle.prototype.initialize = function (x, y, dx, dy) {
            this.position.x = x; this.position.y = y; this.velocity.x = dx; this.velocity.y = dy;
            this.acceleration.x = dx * settings.particles.effect; this.acceleration.y = dy * settings.particles.effect; this.age = 0
        };
        Particle.prototype.update = function (deltaTime) {
            this.position.x += this.velocity.x * deltaTime; this.position.y += this.velocity.y * deltaTime;
            this.velocity.x += this.acceleration.x * deltaTime; this.velocity.y += this.acceleration.y * deltaTime; this.age += deltaTime
        };
        Particle.prototype.draw = function (context, image) {
            function ease(t) { return (--t) * t * t + 1 }
            var size = image.width * ease(this.age / settings.particles.duration);
            context.globalAlpha = 1 - this.age / settings.particles.duration;
            context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size)
        };

        var ParticlePool = function (length) {
            var particles = new Array(length); for (var i = 0; i < particles.length; i++)particles[i] = new Particle();
            var firstActive = 0, firstFree = 0, duration = settings.particles.duration;
            this.add = function (x, y, dx, dy) {
                particles[firstFree].initialize(x, y, dx, dy);
                firstFree++; if (firstFree == particles.length) firstFree = 0; if (firstActive == firstFree) firstActive++;
                if (firstActive == particles.length) firstActive = 0
            };
            this.update = function (deltaTime) {
                var i;
                if (firstActive < firstFree) { for (i = firstActive; i < firstFree; i++)particles[i].update(deltaTime) }
                if (firstFree < firstActive) {
                    for (i = firstActive; i < particles.length; i++)particles[i].update(deltaTime);
                    for (i = 0; i < firstFree; i++)particles[i].update(deltaTime)
                }
                while (particles[firstActive].age >= duration && firstActive != firstFree) {
                    firstActive++;
                    if (firstActive == particles.length) firstActive = 0
                }
            }
            this.draw = function (context, image) {
                var i;
                if (firstActive < firstFree) { for (i = firstActive; i < firstFree; i++)particles[i].draw(context, image) }
                if (firstFree < firstActive) {
                    for (i = firstActive; i < particles.length; i++)particles[i].draw(context, image);
                    for (i = 0; i < firstFree; i++)particles[i].draw(context, image)
                }
            }
        };

        (function (canvas) {
            var context = canvas.getContext("2d"), particles = new ParticlePool(settings.particles.length),
                particleRate = settings.particles.length / settings.particles.duration, time;
            function pointOnHeart(t) {
                return new Point(160 * Math.pow(Math.sin(t), 3),
                    130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25)
            }
            var image = (function () {
                var canvas = document.createElement("canvas"), context = canvas.getContext("2d");
                canvas.width = settings.particles.size; canvas.height = settings.particles.size;
                function to(t) {
                    var point = pointOnHeart(t); point.x = settings.particles.size / 2 + point.x * settings.particles.size / 350;
                    point.y = settings.particles.size / 2 - point.y * settings.particles.size / 350; return point
                }
                context.beginPath(); var t = -Math.PI; var point = to(t); context.moveTo(point.x, point.y);
                while (t < Math.PI) { t += 0.01; point = to(t); context.lineTo(point.x, point.y) }
                context.closePath(); context.fillStyle = "#FF5CA4"; context.fill();
                var image = new Image(); image.src = canvas.toDataURL(); return image
            })();
            function render() {
                requestAnimationFrame(render);
                var newTime = new Date().getTime() / 1000, deltaTime = newTime - (time || newTime); time = newTime;
                context.clearRect(0, 0, canvas.width, canvas.height);
                var amount = particleRate * deltaTime; for (var i = 0; i < amount; i++) {
                    var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
                    var dir = pos.clone().length(settings.particles.velocity);
                    particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y)
                }
                particles.update(deltaTime); particles.draw(context, image)
            }
            function onResize() { canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight }
            window.onresize = onResize; setTimeout(function () { onResize(); render() }, 10)
        })(document.getElementById("pinkboard"));

        // ================= Text tu·∫ßn t·ª± =================
        const texts = [
            "G·∫∑p m·ªôt ng∆∞·ªùi ƒë∆∞·ª£c coi l√† ƒë·ªãnh m·ªánh",
            "Tim m√¨nh l·ª° thu·ªôc v·ªÅ b·∫°n m·∫•t r·ªìi",
            "Tr·ªçn ƒë·ªùi n√†y ch·ªâ mong ƒë∆∞·ª£c c√≥ b·∫°n b√™n c·∫°nh",
            "LOVE H·∫∞NG‚ù§Ô∏è"
        ];
        let index = 0;
        const loveText = document.getElementById("loveText");
        function showNextText() {
            loveText.classList.remove("show");
            setTimeout(() => {
                loveText.textContent = texts[index];
                loveText.classList.add("show");
                index = (index + 1) % texts.length;
            }, 1000);
        }
        setInterval(showNextText, 4000);
        showNextText();
    </script>
    </body>

</html>